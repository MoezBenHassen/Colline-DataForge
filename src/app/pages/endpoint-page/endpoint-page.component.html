<div class="endpoint-page">
    <!-- Header -->
    <h1>{{ metadata.title }}</h1>
    <div class="endpoint-path">
        <code>{{ metadata.path }}</code>
        <button (click)="navigator.clipboard.writeText(metadata.path)">Copy</button>
    </div>
    <div class="short-desc">{{ metadata.shortDescription }}</div>

    <div class="card">
        <form (ngSubmit)="onSubmit()" #dynamicForm="ngForm">

            <div class="formgrid grid">
                <div *ngFor="let param of metadata.params" class="field col-12 md:col-6">
                    <label [for]="param.name" class="block font-bold mb-2">{{ param.label }} <span *ngIf="param.required" class="text-red-500">*</span></label>

                    <ng-container [ngSwitch]="param.type">

                        <p-dropdown
                            *ngSwitchCase="'select'"
                            [options]="param.options!"
                            [(ngModel)]="form[param.name]"
                            [name]="param.name"
                            [id]="param.name"
                            [placeholder]="'Select ' + param.label"
                            [required]="!!param.required"
                            [showClear]="true"
                            styleClass="w-full">
                        </p-dropdown>

                        <input
                            *ngSwitchCase="'number'"
                            pInputText
                            type="number"
                            class="w-full"
                            [(ngModel)]="form[param.name]"
                            [name]="param.name"
                            [id]="param.name"
                            [placeholder]="param.placeholder || param.label"
                            [required]="!!param.required" />

                        <input
                            *ngSwitchCase="'checkbox'"
                            type="checkbox"
                            class="w-full"
                            [(ngModel)]="form[param.name]"
                            [name]="param.name"
                            [id]="param.name" />

                        <ng-container [ngSwitch]="param.type">

                            <div *ngSwitchCase="'file'" class="flex align-items-center gap-2">
                                <p-fileupload
                                    mode="basic"
                                    [name]="param.name"
                                    (onSelect)="onFileSelect($event, param.name)"
                                    [customUpload]="true"
                                    [auto]="true"
                                    [multiple]="false"
                                    chooseLabel="Choose File"
                                    accept="image/*,.pdf,.csv,.xls,.xlsx"
                                    maxFileSize="2000000">
                                </p-fileupload>

                                <span *ngIf="form[param.name]" class="text-sm text-color-secondary">
                                    {{ form[param.name].name }}
                                </span>
                            </div>

                        </ng-container>

                    </ng-container>
                </div>
            </div>

            <div class="flex justify-content-end gap-2 mt-4">
                <p-button
                    label="Reset"
                    icon="pi pi-refresh"
                    styleClass="p-button-outlined"
                    (click)="onReset()">
                </p-button>
                <p-button
                    label="Run"
                    icon="pi pi-play"
                    type="submit"
                    [loading]="loading"
                    [disabled]="dynamicForm.invalid || loading">
                </p-button>
            </div>
        </form>
    </div>

    <!-- Result Panel -->
  <!--  <app-result-panel *ngIf="result" [result]="result"></app-result-panel>
    <div *ngIf="loading">Loading...</div>
    <div *ngIf="error" class="error">{{ error }}</div>-->

    <!-- Docs Section -->
    <app-doc-section [metadata]="metadata"></app-doc-section>
    <!-- FAQ Section -->
    <app-faq-section *ngIf="metadata.faq" [faq]="metadata.faq"></app-faq-section>
</div>
